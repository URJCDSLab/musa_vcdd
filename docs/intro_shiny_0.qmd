---
title: Introducci√≥n a la visualizaci√≥n mediante dashboards
subtitle: M√°ster Universitario en An√°lisis de Datos Deportivos, Universidad Rey Juan Carlos
authors:
    author: "Emilio L√≥pez Cano"
    corresponding: true
---

# Data Science
  
  
## Uni√≥n, no intersecci√≥n
  
  ![](img/ds2.png){width=70% fig-align=center}

::: {.notes}
There is quite a bit of consensus about what Data Science is as a sort of 
mixture between Statistics, Computer Science and domain knowledge. A number 
of representations as Venn Diagrams have been developed. I prefer to see 
Data Science as the union of the three sets rather than the intersection, which is 
almost impossible to have in one person.
:::
  
## R for Data Science
  
::: {layout="[[-1], [1], [-1]]"}

![](https://r4ds.hadley.nz/diagrams/data-science/base.png){fig-align=center}
:::
  
::: footer
Source: [R for Data Science](https://r4ds.hadley.nz) (Wickham, √áetinkaya-Rundel and Grolemund, 2023)
:::
  
## CRISP-DM
  
:::: {.columns}

::: {.column}

* [Despliegue]{.red} puede incluir muchas cosas distintas

* El [uso]{.red} de los modelos

* La [Visualizaci√≥n]{.red} de resultados

* [MLOps]{.red}: como _DevOps_ en inform√°tica

* [Explicabilidad]{.red} de modelos




:::
  
::: {.column}

![](https://upload.wikimedia.org/wikipedia/commons/b/b9/CRISP-DM_Process_Diagram.png){width=120% fig-align=center}

:::
  
::::
  
  
::: footer
Source: <a href="https://commons.wikimedia.org/wiki/File:CRISP-DM_Process_Diagram.png">Kenneth Jensen</a>, <a href="https://creativecommons.org/licenses/by-sa/3.0">CC BY-SA 3.0</a>, via Wikimedia Commons
:::
  
  
  
# Dashboards
  
## Informes est√°ticos
  
:::: {.columns} 

::: {.column}
* Cuadro de mando integral: ejemplo cl√°sico en la empresa

* Informes estad√≠sticos: Normalmente resultados clave con gr√°ficos, tablas e interpretaci√≥n. Seleccionados por analista

* Por dise√±o, pensados para ser impresos en papel, formato [pdf]{.red}

:::
  
::: {.column}
![](img/static_report.png){fig-align=center, width=420}
:::
  
::::
  
::: footer
[Download](http://emilio.lcano.com/p/enbis2023/static_report.Rmd) .Rmd source | [Ver online](http://emilio.lcano.com/p/enbis2023/static_report.pdf)
:::
  
## Dashboards est√°ticos
  
M√°s compactos, dise√±ado para pantalla

![](img/static_dashboard.png){fig-align=center}

::: footer
[Download](http://emilio.lcano.com/p/enbis2023/static_dashboard.Rmd) .Rmd source | [Ver online](http://emilio.lcano.com/p/enbis2023/static_dashboard.html)
:::
  
## Dashboards interactivos
  
Informe est√°tico con elementos interactivos (_widgets_)

![](img/interactive_dashboard.png){fig-align=center}

::: footer
[Download](http://emilio.lcano.com/p/enbis2023/interactive_dashboard.Rmd) .Rmd source | [Ver online](http://emilio.lcano.com/p/enbis2023/interactive_dashboard.html)
:::
  
## Limitaciones y alternativas
  
* Limitados a lo que el estad√≠stico quiere mostrar

* No solo lo van a usar personas expertas en estad√≠stica

* Toma de decisiones a distintos niveles

. . .

* Aplicaciones [Reactivas]{.red} gu√≠an a las partes interesadas en la obtenci√≥n e interpretaci√≥n de resultados

* Los interfaces bien dise√±ados para modelos avanzados favorecen la explicabilidad



# Aplicaciones reactivas



## _Reactive programming_

>The key idea of reactive programming is to specify a graph of dependencies so that when an input changes, all related outputs are automatically updated.
>
  
:::{style="text-align:right;"}
_Hadley Wickham, [Mastering Shiny](https://mastering-shiny.org/basic-reactivity.html)_
:::
  
  
\
\

. . .

Los [outputs]{.red}, i.e., gr√°ficos, tablas, etc., se generan con R cuando los [inputs]{.red}, i.e., selecciones del usuario, cambian.

## Aplicaciones Shiny


* C√≥digo "est√°ndar" de R

* No hace falta nada m√°s, todo el c√≥digo HTML, CSS y JS se genera autom√°ticamente

* Dos "componentes"

* `ui` (interfaz de usuario, p√°gina web). Contiene _inputs_ y _outputs_

* `server`. Contiene objetos _reactivos_ y funciones [generadoras]{.red} (_rendering_)

:::: {.columns}

::: {.column}

- [Descargar](https://shiny.posit.co/r/articles/start/cheatsheet/) Shiny _cheetsheet_

- [Visitar](https://shiny.posit.co/r/gallery/) la _Shiny gallery_

:::
  
::: {.column width="25%"}

![](img/shiny.png){fig-align=center width="140"}

:::
  
::::
  
  
  
## Una aplicaci√≥n shiny simple
  
::: {.small}

```{r}
#| label: shinypenguins
#| eval: false
#| echo: true
library(shiny)
library(palmerpenguins); library(plotly); library(ggplot2)
ui <- fluidPage(title = "Simple demo app",
                sidebarLayout(
                  sidebarPanel(  
                    varSelectInput("varx", "Explanatory variable", penguins |> select(where(is.numeric))),
                    varSelectInput("vary", "Response variable", penguins |> select(where(is.numeric))),
                    varSelectInput("varcol", "Colour variable", penguins |> select(where(is.factor)))),
                  mainPanel( 
                    plotlyOutput("plot"),
                    verbatimTextOutput("model")))
)
server <- function(input, output, session){
  output$plot <- renderPlotly({
    p <- penguins |> ggplot(aes_string(x = input$varx, y = input$vary, col = input$varcol)) +
      geom_point()
    ggplotly(p)})
  output$model <- renderPrint({
    m <- lm(get(input$vary) ~ get(input$varx) + get(input$varcol), penguins)
    summary(m)})
}
shinyApp(ui = ui, server = server)
```

:::
  
  üñ•Ô∏è Live demo ü§ûüèª


## A√±adiendo caracter√≠sticas interesantes

:::: {.columns}

::: {.column}

### Dashboards

* [shinydashboard](https://rstudio.github.io/shinydashboard/)

* [bs4dash](https://rinterface.github.io/bs4Dash/index.html)

* [bslib](https://rstudio.github.io/bslib/)

### Configuraci√≥n

* Aplicaciones [Multilenguaje]{.red} with [shiny.i18n](https://appsilon.github.io/shiny.i18n/index.html)

* Aplicaci√≥n como [paquete](https://mastering-shiny.org/scaling-packaging.html)

:::
  
::: {.column}

### Buenas pr√°cticas de Ing.Soft.

* Versiones de paquetes con [renv](https://rstudio.github.io/renv/index.html)

* Pruebas unitarias con [testthat](https://testthat.r-lib.org) y [shinytest](https://rstudio.github.io/shinytest/)

* Control de versiones e integraci√≥n continua, e.g., con [GitHub](https://github.com)

* [Despliegue como contenedor Docker](https://hosting.analythium.io/running-shiny-server-in-docker/)

:::
  
::::
  
## Shiny modules
  
  * Componentes reutilizables

* Con su propio espacio de nombres (_namespace_)

* Facilitan pruebas y depuraci√≥n

* Complejo de entender al principio

üëâ[Modularizing Shiny app code](https://shiny.posit.co/r/articles/improve/modules/)


# Casos de √©xito y ejemplos en producci√≥n

## AfCIOT - TiVA indicators

* Joint project with [UNECA](https://www.uneca.org), [WTO](https://www.wto.org), and [OECD](https://www.oecd.org)

* International Trade, Environmental and Employment Indicators

* International and multidisciplinar team

* Industry and product classification, gap estimation, policy simulation and [visualisation]{.red}

* Key result: A [shiny app]{.red} for reporting, visualisation and policy simulation

* Several important challenges for the [multinational]{.red} scope

## AfCIOT - TiVA indicators

![](img/afciot.png){width="70%" fig-align="center"}

[Acknowledgements:]{.ack} 
![](img/uneca.png){height="50"}
![](img/wto.png){height="50"}
![](img/oecd.png){height="50"}

::: {style="text-align:center"}
üñ•Ô∏è Live demo ü§ûüèª
:::
  
# Turismo sostenible
  
## EVASTUR
  
-   Proyecto con la empresa [Dephim√°tica](https://www.dephimatica.es)

-   Especializada en estad√≠stica p√∫blica

-   _Capacity building_ en Ciencia de Datos

- Sistema de indicadores de turismo sostenible: exploraci√≥n, visualizaci√≥n, an√°lisis

<!-- <img src="img/dephimatica.png" width="50%"/> -->
  
  <div>
  ![](img/dephimatica.png){width="50%" fig-align="center"}
</div>
  
  
  
## EVASTUR - Dashboard
  
  ![](img/evastur.png){width="70%" fig-align="center"}


::: {style="text-align:center"}
üñ•Ô∏è Live demo ü§ûüèª
:::
  
# Indicadores de pobreza energ√©tica en Brasil
  
## EPE Brasil
  
  -   Weaving Connections: A Comprehensive Diagnosis of Access to and Use of Electricity and Essential Services by Low-Income Population (MRC- SP 0366)

-   Proyecto de transferencia con MRC Consultants and Advisors (Grupo Veolia)

-   ETL, Modelo de datos, visualizaci√≥n

-   Indicadores de pobreza energ√©tica (UCM)

-   Presentado en reuni√≥n del G20




## OBEPE

![](img/obepe.png){width="70%" fig-align="center"}

[Acknowledgements:]{.ack} 
![](img/logo_idb.png){height="50"}
![](img/logo_epe_colors.jpg){height="50"} 
![](img/logo_mme.png){height="50"}

::: {style="text-align:center"}
üñ•Ô∏è Live demo ü§ûüèª
:::
  
# Deporte y ciberseguridad
  
## Anal√≠tica deportiva
  
  ![](img/pace.png)

## Proyectos de investigaci√≥n: DICYME


* Dynamic Industrial Cyber Risk Modelling based on Evidence (DICYME) research project (CPP2021-009025)


* Proyecto de colaboraci√≥n p√∫blico-privada con DeNexus TECH SL.

* Dashboard (no publicado a√∫n)

* Conexi√≥n con MongoDB

* App relacionada: [CRAS](http://gondor.etsii.urjc.es:3804/)

## Aplicaci√≥n shiny CRAS

* An√°lisis de riesgos

* Primer paso: se simulan los eventos en n a√±os

* Segundo paso: se simula el gasto de cada evento

## Resultados

![](img/3_results_density.png)

## Smart Cities
  
  -   Casos de uso para turismo, sanidad e infraestructuras de la Comunidad de Madrid

-   Aplicaciones coherentes paso a paso para los casos de uso (cargar datos -   visualizaci√≥n - modelizaci√≥n - obtenci√≥n de resultados)

-   Algunos casos con [Shiny]{.red}, otros con Python o Power BI

-   Ejemplo: <http://www.citizenlabhub.es/cu/55>

# Apps relacionadas con control de calidad

## S√≠agro - Animal production SPC

::: columns
::: {.column width="40%"}
-   [CRO clinical and nutritional trials](http://www.testsandtrials.com)
-   Shiny app for their customers as a value added service
-   Important \[**productivity improvements**\]
-   Simulation and parameterised reports
:::
  
::: {.column width="60%"}
![](img/testsapp.png)

<img src="img/tests.png" style="width:50%;margin-left:auto;margin-right:auto;display:block;"/>
  
::: small
<https://www.siagro.es> \| üñ•Ô∏è Live demo ü§ûüèª
:::
:::
:::
  


## placido: app para muestreo de aceptaci√≥n

* Resultado de un TFG

* Disponible en: [https://dleo.shinyapps.io/placidoproject/](https://dleo.shinyapps.io/placidoproject/)

* Control de versiones con git y GitHub: [https://github.com/DavidALeo/PlacidoProject/](https://github.com/DavidALeo/PlacidoProject/)

* Documentaci√≥n con {pkgdown}: [https://davidaleo.github.io/PlacidoProject/](https://davidaleo.github.io/PlacidoProject/)


Slides: [emilio.lcano.com/p/seio2023](http://emilio.lcano.com/p/seio2023/)
  
  


## Simulaci√≥n de proceso

* Simula la producci√≥n de lotes

* Se extraen muestras

* SPC + muestreo de aceptaci√≥n

* App disponible en: [https://lcano.shinyapps.io/demo-shiny-quality/](https://lcano.shinyapps.io/demo-shiny-quality/)


  
# Aplicaci√≥n shiny para SPC paso a paso
  
## Caso de uso
  
* Gr√°ficos de control de la media, el rango y la desviaci√≥n t√≠pica

* An√°lisis de capacidad

* Paquete qcc

* Datos de ejemplo del paquete

. . .

Se extiende f√°cilmente para otros datos y paquetes

## Configuraci√≥n inicial

1. Crear un proyecto en RStudio

2. Instalar paquetes shiny, bslib, qcc

3. Crear script vac√≠o

4. Insertar estructura ui + server (por ejemplo con el _snippet_) 

5. Ir a√±adiendo el c√≥digo de los ejemplos de esta presentaci√≥n (o copi√°ndolo entero, cada ejemplo es autocontenido)

## Estructura b√°sica app shiny

```{r}
#| eval: false
#| echo: true
library(shiny)

ui <- fluidPage(
  
)

server <- function(input, output, session) {
  
}

shinyApp(ui, server)
```

## Disposici√≥n del _dashboard_ (_layout_)

* [bslib](https://rstudio.github.io/bslib/articles/dashboards/) tiene muchas opciones

```{r}
#| eval: false
#| echo: true
library(shiny)
library(bslib)

ui <- page_navbar(
  title = "Control Estad√≠stico de procesos ACME",
  sidebar = sidebar(title = "Selecci√≥n"),
  nav_panel(title = "Gr√°fico de Control"),
  nav_panel(title = "An√°lisis de la capacidad del proceso")
)

server <- function(input, output, session) {
  
}

shinyApp(ui, server)
```

## A√±adiendo _inputs_ y _outputs_ al _ui_

```{r}
#| eval: false
#| echo: true
#| code-line-numbers: "9-17,20-21,23"
library(shiny)
library(bslib)
library(qcc)

ui <- page_navbar(
  title = "Control Estad√≠stico de procesos ACME",
  sidebar = sidebar(
    title = "Selecci√≥n",
    selectInput("tipo", "Tipo de gr√°fico", 
                c("xbar", "R", "S" )),
    numericInput("fase1", "Fase 1 hasta muestra", value = 25),
    sliderInput("limites", "L√≠mites de especificaci√≥n",
                min = 73.90, max = 74.15,
                value = c(73.95, 74.05), 
                step = 0.01),
    selectInput("datos", "Datos (fake)", 
                data(package = "qcc")$results[,3])
  ),
  nav_panel(title = "Gr√°fico de Control",
            plotOutput("grafico_control"),
            verbatimTextOutput("salida_control")),
  nav_panel(title = "An√°lisis de la capacidad del proceso",
            plotOutput("grafico_capacidad"))
)

server <- function(input, output, session) {
  
}

shinyApp(ui, server)
```


## A√±adiendo objetos reactivos

```{r}
#| eval: false
#| echo: true
#| code-line-numbers: "25-32"
library(shiny)
library(bslib)
library(qcc)

ui <- page_navbar(
  title = "Control Estad√≠stico de procesos ACME",
  sidebar = sidebar(
    title = "Selecci√≥n",
    selectInput("tipo", "Tipo de gr√°fico", 
                c("xbar", "R", "S" )),
    numericInput("fase1", "Fase 1 hasta muestra", value = 25),
    sliderInput("limites", "L√≠mites de especificaci√≥n",
                min = 73.90, max = 74.15,
                value = c(73.95, 74.05), 
                step = 0.01),
    selectInput("datos", "Datos", data(package = "qcc")$results[,3])),
  nav_panel(title = "Gr√°fico de Control",
            plotOutput("grafico_control"),
            verbatimTextOutput("salida_control")),
  nav_panel(title = "An√°lisis de la capacidad del proceso",
            plotOutput("grafico_capacidad")
  )
)

server <- function(input, output, session) {
  gc <- reactive({
    req(input$tipo, input$fase1)
    data("pistonrings")
    diameter <- qcc.groups(pistonrings$diameter, pistonrings$sample)
    qcc(diameter[1:as.numeric(input$fase1),], 
        type = input$tipo, plot = FALSE)
  }) 
}

shinyApp(ui, server)
```



## Renderizando _outputs_

```{r}
#| eval: false
#| echo: true
#| code-line-numbers: "34-43"
library(shiny)
library(bslib)
library(qcc)

ui <- page_navbar(
  title = "Control Estad√≠stico de procesos ACME",
  sidebar = sidebar(
    title = "Selecci√≥n",
    selectInput("tipo", "Tipo de gr√°fico", c("xbar", "R", "S" )),
    numericInput("fase1", "Fase 1 hasta muestra", value = 25),
    sliderInput("limites", "L√≠mites de especificaci√≥n",
                min = 73.90, max = 74.15,
                value = c(73.95, 74.05), 
                step = 0.01),
    selectInput("datos", "Datos", data(package = "qcc")$results[,3])),
  
  nav_panel(title = "Gr√°fico de Control",
            card(plotOutput("grafico_control"),
                 verbatimTextOutput("salida_control"),
                 fill = FALSE)),
  nav_panel(title = "An√°lisis de la capacidad del proceso",
            plotOutput("grafico_capacidad"))
)

server <- function(input, output, session) {
  gc <- reactive({
    req(input$fase1)
    data("pistonrings")
    diameter <- qcc.groups(pistonrings$diameter, pistonrings$sample)
    qcc(diameter[1:as.numeric(input$fase1),], 
        type = input$tipo, plot = FALSE)
  }) 
  
  output$grafico_control <- renderPlot({
    plot(gc())
  })
  output$salida_control <- renderText({
    paste(capture.output(summary(gc())), collapse = "\n")
  })
  output$grafico_capacidad <- renderPlot({
    req(input$tipo == "xbar")
    process.capability(gc(), input$limites)
  })
}

shinyApp(ui, server)
```


## Dale color - ver c√≥mo queda un tema

```{r}
#| eval: false
#| echo: true
#| code-line-numbers: "26"
library(shiny)
library(bslib)
library(qcc)

ui <- page_navbar(
  title = "Control Estad√≠stico de procesos ACME",
  sidebar = sidebar(
    title = "Selecci√≥n",
    selectInput("tipo", "Tipo de gr√°fico", c("xbar", "R", "S" )),
    numericInput("fase1", "Fase 1 hasta muestra", value = 25),
    sliderInput("limites", "L√≠mites de especificaci√≥n",
                min = 73.90, max = 74.15,
                value = c(73.95, 74.05), 
                step = 0.01),
    selectInput("datos", "Datos", data(package = "qcc")$results[,3])),
  
  nav_panel(title = "Gr√°fico de Control",
            card(plotOutput("grafico_control"),
                 verbatimTextOutput("salida_control"),
                 fill = FALSE)),
  nav_panel(title = "An√°lisis de la capacidad del proceso",
            plotOutput("grafico_capacidad"))
)

server <- function(input, output, session) {
  bs_themer()
  gc <- reactive({
    req(input$fase1)
    data("pistonrings")
    diameter <- qcc.groups(pistonrings$diameter, pistonrings$sample)
    qcc(diameter[1:as.numeric(input$fase1),], 
        type = input$tipo, plot = FALSE)
  }) 
  
  output$grafico_control <- renderPlot({
    plot(gc())
  })
  output$salida_control <- renderText({
    paste(capture.output(summary(gc())), collapse = "\n")
  })
  output$grafico_capacidad <- renderPlot({
    req(input$tipo == "xbar")
    process.capability(gc(), input$limites)
  })
}

shinyApp(ui, server)
```

## Dale color - configura el tema

```{r}
#| eval: false
#| echo: true
#| code-line-numbers: "6"
library(shiny)
library(bslib)
library(qcc)

ui <- page_navbar(
  theme = bs_theme(bootswatch = "minty"),
  title = "Control Estad√≠stico de procesos ACME",
  sidebar = sidebar(
    title = "Selecci√≥n",
    selectInput("tipo", "Tipo de gr√°fico", c("xbar", "R", "S" )),
    numericInput("fase1", "Fase 1 hasta muestra", value = 25),
    sliderInput("limites", "L√≠mites de especificaci√≥n",
                min = 73.90, max = 74.15,
                value = c(73.95, 74.05), 
                step = 0.01),
    selectInput("datos", "Datos", data(package = "qcc")$results[,3])),
  
  nav_panel(title = "Gr√°fico de Control",
            card(plotOutput("grafico_control"),
                 verbatimTextOutput("salida_control"),
                 fill = FALSE)),
  nav_panel(title = "An√°lisis de la capacidad del proceso",
            plotOutput("grafico_capacidad"))
)

server <- function(input, output, session) {
  gc <- reactive({
    req(input$fase1)
    data("pistonrings")
    diameter <- qcc.groups(pistonrings$diameter, pistonrings$sample)
    qcc(diameter[1:as.numeric(input$fase1),], 
        type = input$tipo, plot = FALSE)
  }) 
  
  output$grafico_control <- renderPlot({
    plot(gc())
  })
  output$salida_control <- renderText({
    paste(capture.output(summary(gc())), collapse = "\n")
  })
  output$grafico_capacidad <- renderPlot({
    req(input$tipo == "xbar")
    process.capability(gc(), input$limites)
  })
}

shinyApp(ui, server)
```




## Implentaci√≥n real

* Lectura de datos del proceso en tiempo real

* Monitorizar proceso en fase II

* A√±adir an√°lisis exploratorio

* A√±adir modelos

* Mejorar interfaz

* Complejidad de la app

# Ejercicio

Modifica el c√≥digo de la aplicaci√≥n para hacer el an√°lisis en fase 2 tomando el resto de datos como en el ejemplo de la ayuda de la funci√≥n `qcc()`

# Preguntas? 

`r fontawesome::fa("x-twitter", fill = "#749dae")` [@emilopezcano](https://x.com/emilopezcano)


[http://emilio.lcano.com](https://emilio.lcano.com)

[emilio.lopez@urjc.es]{.red}

Slides: [emilio.lcano.com/p/udc2025](http://emilio.lcano.com/p/udc2025)

\

¬°Gracias!
  
:::{style="text-align:center"}
üñ•Ô∏è Live demo ü§ûüèª
:::
  
  
  